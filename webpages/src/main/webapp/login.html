<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="css/login.css">
<meta charset="UTF-8">
<title>Demo innlogging</title>
</head>
<body>
<div id="outer">
<div id="login_table">
<div id="login_row">
<div id="login_cell">
<div id="login_box">

<h3 id="login_title">Innlogging</h3>
<div id="login_explanation" onclick="postLogin();">
Innlogging krever at du skriver inn telefonnummer og får tilsendt en kode via SMS.
Hvis dette er første innlogging vil telefonnummer bli manuelt sjekket mot telefonkatalogen,
 du vil motta en SMS når dette er gjort og kan forsøke logge inn på nytt.
</div>
<br/>
<br/>
<div id="login_inputs">
<span>SMS telefonnummer:</span><input id="sms_input" type="text"/><input id="login_button" type="button" value="Registrer/Logg inn" onclick="postLogin();"></input>
</div>
<div id="login_status_text">
<br/>
<span id="login_status_must_approve" class="login_status">
Ukjent telefonnummer, du vil motta en SMS når telefonnummer er manuelt godkjent
</span>
<span id="login_status_approving" class="login_status">
Telefonnummer venter på manuell godkjenning, du vil motta en SMS når godkjent
</span>
<span id="login_status_approved" class="login_status">
Skriv inn din kode i feltet under
</span>

</div>
<div id="code_input">
<span>Kode:</span><input id="code_input" type="text"><input id="send_code_button" type="button" value="Send kode" onclick="postCode()"/>
</div>

</div>
</div>
</div>
</div>
</div>

</body>

<script type="text/javascript">

	var baseUrl = "http://localhost:8080/login";

	function postLogin() {
		
		var value = document.getElementById('sms_input').value;

		postAjax(baseUrl + '/checkphoneno?phoneNo=' + value, function(response) {
			
			console.log('## got response'  +response);

			switch (response.status) {
			case 'UNKNOWN_PHONENO':
				hideAll();
				document.getElementById('login_status_must_approve').style.display = "inline";
				break;

			case 'APPROVING':
				hideAll();
				document.getElementById('login_status_approving').style.display = "inline";
				break;

			case 'APPROVED':
				// Show generated-code text and input
				hideAll();
				document.getElementById('login_status_approved').style.display = "inline";
				document.getElementById('code_input').style.display = "inline";
				break;

			default:
				throw "Unknown login status code: " + response.status;
			}
		});
	}
	
	function hideAll() {
		document.getElementById('login_status_must_approve').style.display = "none";
		document.getElementById('login_status_approving').style.display = "none";
		document.getElementById('login_status_approved').style.display = "none";
		document.getElementById('code_input').style.display = "none";
	}
		
	function postAjax(url, onsuccess) {
		
		// Post this using Ajax to server URL and get response on whether is logged in or not
		var request = new XMLHttpRequest(url);

		request.responseType = 'json';
		
		request.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				// Must show message about validation
				onsuccess(this.response);
			}
		};
	
		request.open('POST', url, true);
		
		request.send();
		
	};
</script>

</html>